!function(t,i){if("function"==typeof define&&define.amd)define(["underscore","backbone","jquery","exports"],function(e,n,s,o){n.Hexer=i(t,o,e,n,s)});else if("undefined"!=typeof exports){var e,n=require("underscore"),s=require("backbone");try{e=require("jquery")}catch(o){}i(t,exports,n,s,e)}else t.Backbone.Hexer=i(t,{},t._,t.Backbone,t.jQuery||t.Zepto||t.ender||t.$)}(this,function(t,i,e,n,s){function o(t){return e.isString(t)?parseFloat(t.replace(/\D+$/g,"")):1*t}function h(t){return t+3>5?t-3:t+3}function a(t,i){var n,s=null;return e.each(i,function(i,o){e.isNull(s)&&i.options.distance==t&&(s=o),e.isNull(n)&&!e.isNull(s)&&i.options.distance>t&&(n=o)}),i.slice(s,n)}i=n.Hexer=n.HexGridView=n.View.extend({tagName:"div",className:"bbh-container",defaults:{depth:2,color:"#999999",size:"6em",spacing:"0.5em",center:{x:0,y:0}},events:{},hexes:[],animateTimeout:null,initialize:function(t){this.options=e.extend({},this.defaults,t),this.options.unit=this.options.size.replace(/^\d+/g,""),""==this.options.unit&&(this.options.unit="em"),this.options.size=o(this.options.size),this.options.spacing=o(this.options.spacing),this.options.center.x=o(this.options.center.x),this.options.center.y=o(this.options.center.y),e.bindAll(this,"addAdjacentHexes");var i=s('<svg width="0" height="0"><defs><clipPath id="bbh-hexclip" clipPathUnits="objectBoundingBox"><polygon points="0.5 0 1 0.25 1 0.75 0.5 1 0 0.75 0 0.25"/></clipPath></defs></svg>');document.body.insertBefore(i[0],document.body.childNodes[0]),this.createHexViews()},render:function(){return e.each(this.hexes,function(t,i){t.render()}),this},createHexViews:function(){for(var t="fill"==this.options.depth?10:this.options.depth,i=0;t>i;i++)switch(i){case 0:this.addHex({distance:0,x:this.options.center.x,y:this.options.center.y});break;default:var n=a(i-1,this.hexes);e.each(n,function(t,i){this.addAdjacentHexes(t,0,6)}.bind(this))}},addHex:function(t){t=e.extend({size:this.options.size+this.options.unit,color:this.options.color},t);var i=new r(t);return this.hexes.push(i),this.$el.append(i.$el),i},addAdjacentHex:function(t,i,n){var s=0==i?0:2*Math.PI/6*i,o=this.options.size+this.options.spacing,a=t.options.x+Math.cos(s)*o,r=t.options.y+Math.sin(s)*o,c=t.options.distance+1,d=h(i),p={};p[d]=t;var u=this.addHex(e.extend({x:a,y:r,distance:c,neighbors:p},n));t.addNeighbor(i,u,!0);var l=i-1>=0?i-1:i+5,f=6>i+1?i+1:i-5;e.has(t.options.neighbors,l)&&u.addNeighbor(l-1,t.options.neighbors[l],!0),e.has(t.options.neighbors,f)&&u.addNeighbor(f+1,t.options.neighbors[f],!0)},addAdjacentHexes:function(t,i,n){n>6&&(n=6),i>5&&(i-=6);for(var s=i;i+n>s;s++)(e.isUndefined(t.options.neighbors[s])||e.isNull(t.options.neighbors[s]))&&this.addAdjacentHex(t,s,{})},animate:function(t){var i=e.extend({animateFunction:function(t){},animateQueue:[this.hexes],delay:50},t),n=function(t,e,s){for(var o=t.shift(),h=0;h<o.length;h++)e(o[h]);t.length&&(this.animateTimeout=setTimeout(function(){n(t,e,s)},i.delay))};n(e.clone(i.animateQueue),i.animateFunction,i.delay)}});var r=n.View.extend({tagName:"div",className:"bbh-hex",defaults:{x:0,y:0,size:"3em",color:"#999999",content:"",neighbors:{}},neighbors:{},initialize:function(t){this.options=e.extend({},this.defaults,t),this.options.unit=this.options.size.replace(/^\d+/g,""),this.options.size=o(this.options.size),e.isFunction(this.options.content)&&(this.content=this.options.content)},render:function(){var t={clipPath:"url(#bbh-hexclip)",webkitClipPath:"url(#bbh-hexclip)",transform:"translateX("+this.options.x+this.options.unit+") translateY("+this.options.y+this.options.unit+")",webkitTransform:"translateX("+this.options.x+this.options.unit+" translateY("+this.options.y+this.options.unit+")",width:Math.sqrt(3)/2*this.options.size+this.options.unit,height:this.options.size+this.options.unit};return e.isNull(this.options.color)&&(t.background=this.options.color),this.$el.css(t),this.$el.html('<div class="content"><span>'+this.content.call(this)+"</span></div>"),this},content:function(){return this.options.content},addNeighbor:function(t,i,n){n=e.isUndefined(n)?!1:n,t=t>5?t-6:t,t=0>t?t+6:t,this.options.neighbors[t]=i,n===!0&&i.addNeighbor(h(t),this,!1)}});return i.VERSION="0.0.1",i});
//# sourceMappingURL=backbone.hexer.min.js.map
